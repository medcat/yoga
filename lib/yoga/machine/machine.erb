digraph machine {

  rankdir="LR";
  node [fontsize=10.0 fontname="courier"];
  edge [fontsize=10.0 fontname="courier" arrowhead="vee"];

  starting [shape=point];
<% if parts.any?(&:stuck?) -%>
  pstuck [fontcolor=red];
<% end -%>

<% starting.each do |part| -%>
  starting -> p<%= part.id %> [label="start" fontcolor=cornflowerblue];
<% end -%>

<% parts.each do |part| -%>
  p<%= part.id %> [label="<%= part.id[0..9] %>" <% if part.accepting %> shape="box" <% end %>];
<%   part.transitions.each do |on, to| %>
<%     if on.is_a? Epsilon -%>
    p<%= part.id %> -> p<%= to.id %> [label="ε" color="green"]
<%     elsif on.is_a? Exclusion -%>
    p<%= part.id %> -> p<%= to.id %> [label="Σ - '<%= on.to_a.join("', '") %>'"]
<%     else -%>
    p<%= part.id %> -> p<%= to.id %> [label="'<%= on.to_a.join("', '") %>'"]
<%     end -%>
<%   end -%>
<% end -%>

  alphabet [label="alphabet: \n'<%= alphabet.to_a.join("', '") %>'" shape="box" fontsize=8.0];
}
